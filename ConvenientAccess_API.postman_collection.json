{
  "info": {
    "_postman_id": "ca-api-collection-2024",
    "name": "ConvenientAccess API",
    "description": "ConvenientAccess 白名单管理系统 API 接口文档\n\n基于 WhitelistPlus 设计理念，用于管理 Minecraft 服务器的白名单系统。\n\n## 认证方式\n\n### API Token 认证（推荐）\n- 使用 `X-API-Key` 头\n- 或使用 `Authorization: Bearer <token>` 头\n\n### 管理员密码认证\n- 使用 `X-Admin-Password` 头\n\n## 公开端点（无需认证）\n- `/api/v1/admin/login`\n- `/api/v1/admin/register`\n- `/api/v1/health`\n- `/api/v1/players/list`\n- `/api/v1/worlds/list`\n- `/api/v1/system/resources`",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "0.5.0"
  },
  "auth": {
    "type": "apikey",
    "apikey": [
      {
        "key": "key",
        "value": "X-API-Key",
        "type": "string"
      },
      {
        "key": "value",
        "value": "{{api_token}}",
        "type": "string"
      },
      {
        "key": "in",
        "value": "header",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://api.mcwok.cn/api/v1",
      "type": "string",
      "description": "API 基础 URL"
    },
    {
      "key": "api_token",
      "value": "sk-your-api-token-here",
      "type": "string",
      "description": "API Token (从服务器 config.yml 获取)"
    },
    {
      "key": "admin_password",
      "value": "your-admin-password",
      "type": "string",
      "description": "管理员密码"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string",
      "description": "JWT Token (登录后获取)"
    }
  ],
  "item": [
    {
      "name": "白名单管理",
      "description": "白名单增删改查操作",
      "item": [
        {
          "name": "获取白名单列表",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/whitelist?page=1&size=20&search=&sort=created_at&order=desc",
              "host": ["{{base_url}}"],
              "path": ["whitelist"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "页码，默认为1"
                },
                {
                  "key": "size",
                  "value": "20",
                  "description": "每页大小，默认为20"
                },
                {
                  "key": "search",
                  "value": "",
                  "description": "搜索关键词"
                },
                {
                  "key": "sort",
                  "value": "created_at",
                  "description": "排序字段 (name, uuid, created_at)"
                },
                {
                  "key": "order",
                  "value": "desc",
                  "description": "排序方向 (asc, desc)"
                }
              ]
            },
            "description": "获取白名单列表，支持分页、搜索和排序。\n\n当 `uuid` 字段为 `null` 且 `uuid_pending` 为 `true` 时，表示该玩家的UUID将在首次登录时自动补充。"
          },
          "response": []
        },
        {
          "name": "添加白名单条目",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"PlayerName\",\n  \"source\": \"API\",\n  \"added_by_name\": \"AdminName\",\n  \"added_by_uuid\": \"admin-uuid-here\",\n  \"added_at\": \"2024-01-01T12:00:00\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/whitelist",
              "host": ["{{base_url}}"],
              "path": ["whitelist"]
            },
            "description": "添加新的白名单条目（基于WhitelistPlus设计理念）。\n\n**只需要玩家名即可添加白名单，UUID会在玩家首次登录时自动补充！**\n\n## 参数说明\n- `name` (必需): 玩家名称\n- `source` (必需): 添加来源 (PLAYER, ADMIN, SYSTEM, API)\n- `added_by_name` (可选): 添加者名称，默认为 \"API\"\n- `added_by_uuid` (可选): 添加者UUID\n- `added_at` (可选): 添加时间，ISO格式"
          },
          "response": []
        },
        {
          "name": "添加白名单条目（最简版）",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"PlayerName\",\n  \"source\": \"API\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/whitelist",
              "host": ["{{base_url}}"],
              "path": ["whitelist"]
            },
            "description": "添加白名单条目的最简版本，只需要玩家名和来源即可。"
          },
          "response": []
        },
        {
          "name": "删除白名单条目",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/whitelist/:uuid",
              "host": ["{{base_url}}"],
              "path": ["whitelist", ":uuid"],
              "variable": [
                {
                  "key": "uuid",
                  "value": "550e8400-e29b-41d4-a716-446655440000",
                  "description": "玩家UUID"
                }
              ]
            },
            "description": "删除指定UUID的白名单条目。"
          },
          "response": []
        },
        {
          "name": "批量添加白名单",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"operation\": \"add\",\n  \"source\": \"API\",\n  \"added_by_name\": \"AdminName\",\n  \"added_by_uuid\": \"admin-uuid-here\",\n  \"added_at\": \"2024-01-01T12:00:00\",\n  \"players\": [\n    {\n      \"name\": \"Player1\"\n    },\n    {\n      \"name\": \"Player2\"\n    },\n    {\n      \"name\": \"Player3\"\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/whitelist/batch",
              "host": ["{{base_url}}"],
              "path": ["whitelist", "batch"]
            },
            "description": "批量添加白名单条目。"
          },
          "response": []
        },
        {
          "name": "批量删除白名单",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"operation\": \"remove\",\n  \"added_by_name\": \"AdminName\",\n  \"added_by_uuid\": \"admin-uuid-here\",\n  \"players\": [\n    {\n      \"uuid\": \"550e8400-e29b-41d4-a716-446655440000\"\n    },\n    {\n      \"uuid\": \"550e8400-e29b-41d4-a716-446655440001\"\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/whitelist/batch",
              "host": ["{{base_url}}"],
              "path": ["whitelist", "batch"]
            },
            "description": "批量删除白名单条目。"
          },
          "response": []
        },
        {
          "name": "获取白名单统计信息",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/whitelist/stats",
              "host": ["{{base_url}}"],
              "path": ["whitelist", "stats"]
            },
            "description": "获取白名单统计信息，包括总数、活跃数、UUID待补充数、来源分解等。"
          },
          "response": []
        },
        {
          "name": "手动触发同步",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/whitelist/sync",
              "host": ["{{base_url}}"],
              "path": ["whitelist", "sync"]
            },
            "description": "手动触发白名单同步任务。"
          },
          "response": []
        },
        {
          "name": "获取同步状态",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/whitelist/sync/status",
              "host": ["{{base_url}}"],
              "path": ["whitelist", "sync", "status"]
            },
            "description": "获取白名单同步状态信息。"
          },
          "response": []
        }
      ]
    },
    {
      "name": "管理员认证",
      "description": "管理员登录、注册和令牌管理",
      "item": [
        {
          "name": "管理员登录",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success && jsonData.data && jsonData.data.token) {",
                  "    pm.collectionVariables.set(\"jwt_token\", jsonData.data.token);",
                  "    console.log(\"JWT Token 已保存到变量\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"your-password\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/admin/login",
              "host": ["{{base_url}}"],
              "path": ["admin", "login"]
            },
            "description": "管理员登录，返回 JWT Token。\n\n**此端点无需认证（公开端点）**\n\n登录成功后，JWT Token 会自动保存到 `jwt_token` 变量中。"
          },
          "response": []
        },
        {
          "name": "管理员注册",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"reg_xxxxxxxxxxxxxxxxxxxxxxxxx\",\n  \"username\": \"newadmin\",\n  \"password\": \"secure-password\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/admin/register",
              "host": ["{{base_url}}"],
              "path": ["admin", "register"]
            },
            "description": "使用注册令牌注册新管理员。\n\n**此端点无需 API Token 认证，但需要有效的注册令牌。**"
          },
          "response": []
        },
        {
          "name": "获取当前管理员信息",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{jwt_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/me",
              "host": ["{{base_url}}"],
              "path": ["admin", "me"]
            },
            "description": "获取当前已登录管理员的信息。\n\n**需要 JWT Token 认证**"
          },
          "response": []
        },
        {
          "name": "生成注册令牌",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{jwt_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"expiryHours\": 24\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/admin/generate-token",
              "host": ["{{base_url}}"],
              "path": ["admin", "generate-token"]
            },
            "description": "生成管理员注册令牌。\n\n**需要 JWT Token 认证**\n\n## 参数说明\n- `expiryHours`: 令牌有效期（小时）"
          },
          "response": []
        }
      ]
    },
    {
      "name": "用户注册",
      "description": "用户自助注册白名单功能",
      "item": [
        {
          "name": "用户自助注册（完整版）",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"reg_xxxxxxxxxxxxxxxxxxxxxxxxx\",\n  \"playerName\": \"PlayerName\",\n  \"playerUuid\": \"550e8400-e29b-41d4-a716-446655440000\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/register",
              "host": ["{{base_url}}"],
              "path": ["register"]
            },
            "description": "用户自助注册白名单（提供完整信息）。\n\n用户需要从管理员处获取注册令牌（鉴权码），使用玩家名称和UUID进行注册。\n\n## 参数说明\n- `token` (必需): 注册令牌\n- `playerName` (必需): Minecraft 游戏名称\n- `playerUuid` (必需): Minecraft UUID"
          },
          "response": []
        },
        {
          "name": "用户自助注册（简化版）",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"reg_xxxxxxxxxxxxxxxxxxxxxxxxx\",\n  \"playerName\": \"PlayerName\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/register",
              "host": ["{{base_url}}"],
              "path": ["register"]
            },
            "description": "用户自助注册白名单（只需玩家名）。\n\nUUID 将在玩家首次登录时自动补充。"
          },
          "response": []
        }
      ]
    },
    {
      "name": "玩家数据查询",
      "description": "获取玩家详细信息",
      "item": [
        {
          "name": "查询在线玩家数据",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/player?name=PlayerName",
              "host": ["{{base_url}}"],
              "path": ["player"],
              "query": [
                {
                  "key": "name",
                  "value": "PlayerName",
                  "description": "玩家名称（区分大小写）"
                }
              ]
            },
            "description": "获取在线玩家的详细数据，包括位置、生命值、背包、装备等完整信息。\n\n**注意：** 此接口只返回在线玩家数据。如需查询离线玩家，请使用 `includeOffline=true` 参数。"
          },
          "response": []
        },
        {
          "name": "查询离线玩家数据",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/player?name=PlayerName&includeOffline=true",
              "host": ["{{base_url}}"],
              "path": ["player"],
              "query": [
                {
                  "key": "name",
                  "value": "PlayerName",
                  "description": "玩家名称（区分大小写）"
                },
                {
                  "key": "includeOffline",
                  "value": "true",
                  "description": "是否查询离线玩家"
                }
              ]
            },
            "description": "查询离线玩家的基本数据。\n\n**注意：** 离线玩家只能获取有限的基本信息，如玩家名、UUID、首次/最后登录时间、重生点等。"
          },
          "response": []
        }
      ]
    },
    {
      "name": "服务器监控",
      "description": "服务器状态和性能监控",
      "item": [
        {
          "name": "获取服务器详细信息",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/server/info",
              "host": ["{{base_url}}"],
              "path": ["server", "info"]
            },
            "description": "获取服务器的详细信息。"
          },
          "response": []
        },
        {
          "name": "获取服务器状态",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/server/status",
              "host": ["{{base_url}}"],
              "path": ["server", "status"]
            },
            "description": "获取服务器状态信息，包括在线状态、Spark可用性、插件版本等。"
          },
          "response": []
        },
        {
          "name": "获取服务器性能数据",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/server/performance",
              "host": ["{{base_url}}"],
              "path": ["server", "performance"]
            },
            "description": "获取服务器性能数据，包括 TPS、MSPT、内存使用、CPU 使用率等。\n\n当服务器安装了 Spark 插件时，会使用 Spark 提供的高精度数据。"
          },
          "response": []
        },
        {
          "name": "获取在线玩家数量",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/players/online",
              "host": ["{{base_url}}"],
              "path": ["players", "online"]
            },
            "description": "获取当前在线玩家数量。"
          },
          "response": []
        },
        {
          "name": "获取详细玩家列表",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/players/list",
              "host": ["{{base_url}}"],
              "path": ["players", "list"]
            },
            "description": "获取详细的在线玩家列表。\n\n**此端点无需认证（公开端点）**"
          },
          "response": []
        },
        {
          "name": "获取世界列表",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/worlds/list",
              "host": ["{{base_url}}"],
              "path": ["worlds", "list"]
            },
            "description": "获取服务器世界列表及相关信息。\n\n**此端点无需认证（公开端点）**"
          },
          "response": []
        },
        {
          "name": "获取系统资源信息",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/system/resources",
              "host": ["{{base_url}}"],
              "path": ["system", "resources"]
            },
            "description": "获取系统资源使用情况。\n\n**此端点无需认证（公开端点）**"
          },
          "response": []
        },
        {
          "name": "健康检查",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "健康检查端点，用于监控服务状态。\n\n**此端点无需认证（公开端点）**\n\n返回服务状态、运行时间、版本和各组件健康状态。"
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    }
  ]
}
